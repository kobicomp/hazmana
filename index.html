<!DOCTYPE html>
<html dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>ממשק ניהול - יצירת טופס הזמנות</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .form-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
        }

        h2 {
            margin-top: 0;
            color: #2563eb;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 5px;
        }

        .radio-group {
            display: flex;
            gap: 20px;
            margin: 10px 0;
        }

        .radio-group label {
            font-weight: normal;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            background: #2563eb;
            color: white;
            font-size: 16px;
        }

        button:hover {
            opacity: 0.9;
        }

        #itemsContainer div {
            margin-bottom: 15px;
            padding: 15px;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
        }

        .preview {
            margin-top: 20px;
            padding: 15px;
            background: #f8fafc;
            border-radius: 4px;
        }

        .error {
            color: #dc2626;
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>יצירת טופס הזמנות</h1>

        <form id="generatorForm">
            <div class="form-section">
                <h2>הגדרות בסיסיות</h2>
                <div class="form-group">
                    <label>סוג מערכת:</label>
                    <div class="radio-group">
                        <label>
                            <input type="radio" name="bookingType" value="time" checked 
                                   onchange="toggleSystemType()"> מערכת הזמנת תורים
                        </label>
                        <label>
                            <input type="radio" name="bookingType" value="item" 
                                   onchange="toggleSystemType()"> מערכת הזמנת פריטים
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label>כותרת הטופס:</label>
                    <input type="text" id="pageTitle" required>
                </div>
            </div>

            <div class="form-section">
                <h2>הגדרות Google</h2>
                <div class="form-group">
                    <label>קישור לטופס גוגל:</label>
                    <input type="url" id="formUrl" required>
                </div>
                <div class="form-group">
                    <label>Entry ID לשם:</label>
                    <input type="text" id="nameEntry" required>
                </div>
                <div class="form-group">
                    <label>Entry ID לערך (זמן/פריט):</label>
                    <input type="text" id="valueEntry" required>
                </div>
                <div class="form-group">
                    <label>קישור לגיליון גוגל:</label>
                    <input type="url" id="sheetsUrl" required>
                </div>
            </div>

            <div id="timeSettings" class="form-section">
                <h2>הגדרות זמן</h2>
                <div class="form-group">
                    <label>שעת התחלה:</label>
                    <input type="time" id="startTime" value="16:00" required>
                </div>
                <div class="form-group">
                    <label>שעת סיום:</label>
                    <input type="time" id="endTime" value="20:00" required>
                </div>
                <div class="form-group">
                    <label>הפרש זמן בין תורים (בדקות):</label>
                    <select id="timeInterval" required>
                        <option value="15">15 דקות</option>
                        <option value="30">30 דקות</option>
                        <option value="45">45 דקות</option>
                        <option value="60">שעה</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="enableNavigation" checked>
                        אפשר ניווט בין ימים
                    </label>
                </div>
            </div>

            <div id="itemSettings" class="form-section" style="display: none;">
                <h2>הגדרות פריטים</h2>
                <button type="button" onclick="addItem()">הוסף פריט</button>
                <div id="itemsContainer"></div>
            </div>

            <button type="submit">צור טופס</button>
        </form>

        <div class="preview">
            <h3>תצוגה מקדימה של ההגדרות</h3>
            <pre id="previewConfig"></pre>
        </div>
    </div>

    <script>
        async function loadTemplate() {
            try {
                const response = await fetch('template.html');
                return await response.text();
            } catch (error) {
                console.error('Error loading template:', error);
                alert('שגיאה בטעינת התבנית. אנא ודא שקובץ template.html נמצא באותה תיקייה.');
                return null;
            }
        }

        function toggleSystemType() {
            const type = document.querySelector('input[name="bookingType"]:checked').value;
            document.getElementById('timeSettings').style.display = type === 'time' ? 'block' : 'none';
            document.getElementById('itemSettings').style.display = type === 'item' ? 'block' : 'none';
        }

        function addItem() {
            const container = document.getElementById('itemsContainer');
            const itemDiv = document.createElement('div');
            itemDiv.innerHTML = `
                <div class="form-group">
                    <label>שם הפריט:</label>
                    <input type="text" class="item-name" required>
                </div>
                <div class="form-group">
                    <label>מחיר:</label>
                    <input type="number" class="item-price">
                </div>
                <div class="form-group">
                    <label>תיאור:</label>
                    <input type="text" class="item-description">
                </div>
                <div class="form-group">
                    <label>כמות במלאי:</label>
                    <input type="number" class="item-quantity">
                </div>
                <button type="button" onclick="this.parentElement.remove()">הסר פריט</button>
            `;
            container.appendChild(itemDiv);
        }

        function collectFormData() {
            const type = document.querySelector('input[name="bookingType"]:checked').value;
            
            let config = {
                BOOKING_TYPE: type,
                PAGE_TITLE: document.getElementById('pageTitle').value,
                FORM_URL: document.getElementById('formUrl').value,
                NAME_ENTRY: document.getElementById('nameEntry').value,
                VALUE_ENTRY: document.getElementById('valueEntry').value,
                SHEETS_URL: document.getElementById('sheetsUrl').value
            };

            if (type === 'time') {
                const [startHour, startMinute] = document.getElementById('startTime').value.split(':');
                const [endHour, endMinute] = document.getElementById('endTime').value.split(':');
                
                config = {
                    ...config,
                    START_TIME: parseInt(startHour),
                    END_TIME: parseInt(endHour),
                    TIME_INTERVAL: parseInt(document.getElementById('timeInterval').value),
                    ENABLE_NAVIGATION: document.getElementById('enableNavigation').checked
                };
            } else {
                const items = Array.from(document.getElementsByClassName('item-name')).map((input, index) => ({
                    id: index + 1,
                    name: input.value,
                    price: input.parentElement.parentElement.querySelector('.item-price').value,
                    description: input.parentElement.parentElement.querySelector('.item-description').value,
                    quantity: input.parentElement.parentElement.querySelector('.item-quantity').value
                }));
                
                config.ITEMS_LIST = JSON.stringify(items);
            }

            return config;
        }

        document.getElementById('generatorForm').onsubmit = async (e) => {
            e.preventDefault();
            
            const template = await loadTemplate();
            if (!template) return;

            const config = collectFormData();
            let finalHtml = template;

            // החלפת כל הפלייסהולדרים
            Object.entries(config).forEach(([key, value]) => {
                const placeholder = `{{${key}}}`;
                finalHtml = finalHtml.replaceAll(placeholder, value);
            });

            // יצירת והורדת הקובץ
            const blob = new Blob([finalHtml], { type: 'text/html;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'booking-form.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            // עדכון תצוגה מקדימה
            document.getElementById('previewConfig').textContent = 
                JSON.stringify(config, null, 2);
        };
    </script>
</body>
</html>
